<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Instagram-style Reels</title>
  <style>
    body {
      margin: 0;
      background: black;
    }

    .reel {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: black;
    }
  </style>
</head>
<body>

  <!-- پنج ویدیو با آدرس گیت‌هاب -->
  <div class="reel" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4"></div>
  <div class="reel" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4"></div>
  <div class="reel" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4"></div>
  <div class="reel" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4"></div>
  <div class="reel" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4"></div>

  <script>
    const reels = document.querySelectorAll('.reel');
    let currentlyPlaying = null;

    const observer = new IntersectionObserver(async (entries) => {
      for (let entry of entries) {
        const reel = entry.target;

        if (entry.isIntersecting) {
          if (!reel.querySelector('video')) {
            const video = document.createElement('video');
            video.src = reel.dataset.src;
            video.muted = true;
            video.loop = false;
            video.playsInline = true;
            video.autoplay = false;
            video.style.pointerEvents = 'none';

            reel.appendChild(video);

            video.addEventListener('timeupdate', () => {
              // استاپ نزدیک پایان ویدیو
              if (video.duration - video.currentTime < 0.5) {
                video.pause();
                video.currentTime = video.duration;
              }
            });

            video.addEventListener('loadeddata', () => {
              video.play();
              currentlyPlaying = video;
            });
          } else {
            const video = reel.querySelector('video');
            video.currentTime = 0;
            video.play();
            currentlyPlaying = video;
          }
        } else {
          const video = reel.querySelector('video');
          if (video) {
            video.pause();
          }
        }
      }
    }, {
      threshold: 0.8
    });

    reels.forEach((reel, i) => {
      observer.observe(reel);
    });
  </script>
</body>
</html>
