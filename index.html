<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>پخش ویدیو با تأخیر و فریم آخر</title>
  <style>
    body {
      margin: 0;
      background: black;
      font-family: sans-serif;
    }

    .video-wrapper {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      pointer-events: none;
      background-color: black;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    .video-wrapper.playing .video-overlay {
      display: none;
    }
  </style>
</head>
<body>

  <!-- هر ویدیو داخل یک wrapper با یک overlay از فریم آخر -->
  <div class="video-wrapper" data-loaded="false">
    <div class="video-overlay" style="background-image: url('frame.jpg');"></div>
    <video data-src="Gray Illustrative Restaurant Menu.mp4" muted playsinline></video>
  </div>

  <div class="video-wrapper" data-loaded="false">
    <div class="video-overlay" style="background-image: url('frame.jpg');"></div>
    <video data-src="Gray Illustrative Restaurant Menu.mp4" muted playsinline></video>
  </div>

  <div class="video-wrapper" data-loaded="false">
    <div class="video-overlay" style="background-image: url('frame.jpg');"></div>
    <video data-src="Gray Illustrative Restaurant Menu.mp4" muted playsinline></video>
  </div>

  <div class="video-wrapper" data-loaded="false">
    <div class="video-overlay" style="background-image: url('frame.jpg');"></div>
    <video data-src="Gray Illustrative Restaurant Menu.mp4" muted playsinline></video>
  </div>

  <div class="video-wrapper" data-loaded="false">
    <div class="video-overlay" style="background-image: url('frame.jpg');"></div>
    <video data-src="Gray Illustrative Restaurant Menu.mp4" muted playsinline></video>
  </div>

  <script>
    const wrappers = document.querySelectorAll('.video-wrapper');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const wrapper = entry.target;
        const video = wrapper.querySelector('video');

        if (entry.isIntersecting && !wrapper.dataset.loaded) {
          wrapper.dataset.loaded = "true";

          // ۲ ثانیه صبر می‌کنیم، اگر هنوز توی دید بود، پخش می‌کنیم
          setTimeout(() => {
            if (isInViewport(wrapper)) {
              video.src = video.dataset.src;
              wrapper.classList.add('playing');
              video.play();

              video.onended = () => {
                video.pause();
                video.currentTime = video.duration;
              };
            }
          }, 2000);
        }
      });
    }, {
      threshold: 0.6
    });

    wrappers.forEach(wrapper => {
      observer.observe(wrapper);
    });

    // تابع بررسی اینکه عنصر هنوز در دید هست یا نه
    function isInViewport(el) {
      const rect = el.getBoundingClientRect();
      return (
        rect.top < window.innerHeight &&
        rect.bottom > 0
      );
    }
  </script>

</body>
</html>
