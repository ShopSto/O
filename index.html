<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ویدیو با لود تنبل و پخش هوشمند</title>
  <style>
    body {
      margin: 0;
      background: black;
    }

    .video-wrapper {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    .video-placeholder, video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    video {
      position: absolute;
      top: 0;
      left: 0;
      display: none;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <!-- تکرار ۵ ویدیو با عکس صحیح -->
  <!-- فقط عکس نمایش داده می‌شود. ویدیو بعداً لود می‌شود -->
  <div class="video-wrapper" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4">
    <img class="video-placeholder" src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu%20(1).png" alt="preview" />
  </div>

  <div class="video-wrapper" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4">
    <img class="video-placeholder" src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu%20(1).png" alt="preview" />
  </div>

  <div class="video-wrapper" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4">
    <img class="video-placeholder" src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu%20(1).png" alt="preview" />
  </div>

  <div class="video-wrapper" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4">
    <img class="video-placeholder" src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu%20(1).png" alt="preview" />
  </div>

  <div class="video-wrapper" data-src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu.mp4">
    <img class="video-placeholder" src="https://raw.githubusercontent.com/ShopSto/O/main/Gray%20Illustrative%20Restaurant%20Menu%20(1).png" alt="preview" />
  </div>

  <script>
    const wrappers = document.querySelectorAll('.video-wrapper');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const wrapper = entry.target;

        if (entry.isIntersecting && !wrapper.dataset.playing) {
          wrapper.dataset.playing = 'true';

          setTimeout(() => {
            if (isInViewport(wrapper)) {
              const video = document.createElement('video');
              video.src = wrapper.dataset.src;
              video.muted = true;
              video.playsInline = true;
              video.style.position = "absolute";
              video.style.top = 0;
              video.style.left = 0;
              video.style.width = "100%";
              video.style.height = "100%";
              video.style.objectFit = "cover";
              video.style.display = "block";
              video.style.pointerEvents = "none";

              const placeholder = wrapper.querySelector('img');
              placeholder.style.display = "none";

              wrapper.appendChild(video);
              video.play();

              video.onended = () => {
                video.pause();
                video.currentTime = video.duration;
              };
            } else {
              wrapper.dataset.playing = 'false';
            }
          }, 2000);
        }
      });
    }, {
      threshold: 0.6
    });

    wrappers.forEach(wrapper => observer.observe(wrapper));

    function isInViewport(el) {
      const rect = el.getBoundingClientRect();
      return rect.top < window.innerHeight && rect.bottom > 0;
    }
  </script>
</body>
</html>
